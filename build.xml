<project name="whiley" default="build-all">  
  <import file="config.xml"/>

  <!-- Build Commands -->

  <target name="build-all">
    <subant failonerror="true" target="build">
      <fileset dir="modules" includes="wyil/build.xml"/>
      <fileset dir="modules" includes="wyc/build.xml"/>
      <fileset dir="modules" includes="wyrt/build.xml"/>
      <fileset dir="modules" includes="wyjc/build.xml"/>
    </subant>
  </target>
 
  <!-- Documenation --> 

  <target name="doc">
    <subant failonerror="true" target="doc">
      <fileset dir="modules" includes="wyil/build.xml"/>
      <fileset dir="modules" includes="wyc/build.xml"/>
      <fileset dir="modules" includes="wyrt/build.xml"/>
      <fileset dir="modules" includes="wyjc/build.xml"/>
    </subant>    
  </target>

  <!-- Misc Commands -->

  <target name="clean">
    <subant failonerror="false" target="clean">
      <fileset dir="modules" includes="*/build.xml"/>
    </subant>
    <delete includeEmptyDirs="true" failonerror="false">
      <fileset file="*~"/>
      <fileset dir="lib"/>
      <fileset dir="docs"/>
      <fileset dir="tests">
	<include name="**/*.class"/>
	<include name="**/*.wyil"/>
      </fileset>
    </delete>
  </target>

  <!-- Distributions -->
 
  <target name="distjars">
    <subant failonerror="false" target="dist">
      <fileset dir="modules" includes="*/build.xml"/>
    </subant>
  </target>

  <target name="distsrc">
  <mkdir dir="wdk-v${version}"/>
  <copy todir="wdk-v${version}">
    <fileset dir=".">
      <include name="modules/wyil/**/*.java"/>
      <include name="modules/wyc/**/*.java"/>
      <include name="modules/wyjc/**/*.java"/>
      <include name="modules/wyrt/**/*.whiley"/>
    </fileset>
    <fileset dir="." includes="tests/**/*.whiley,tests/**/*.sysout"/>
    <fileset dir="." includes="examples/**/*.whiley"/>
    <fileset dir=".">
      <include name="bin/wyilc"/>
      <include name="bin/wyc"/>
      <include name="bin/wyjc"/>
      <include name="bin/wyj"/>
    </fileset>
    <fileset dir="." includes="LICENSE,README,build.xml,config.xml"/>
    <fileset dir=".">
      <include name="lib/wyil-v${version}.jar"/>
      <include name="lib/wyc-v${version}.jar"/>
      <include name="lib/wyrt-v${version}.jar"/>
      <include name="lib/wyjc-v${version}.jar"/>
    </fileset>
  </copy>
  <tar destfile="dist/wdk-src-v${version}.tar" longfile="gnu">  
    <tarfileset dir="." includes="wdk-v${version}/**/*.java"/>
    <tarfileset dir="." includes="wdk-v${version}/**/*.whiley"/>
    <tarfileset dir="." includes="wdk-v${version}/**/*.sysout"/>
    <tarfileset dir="." filemode="755">
      <include name="wdk-v${version}/bin/wyilc"/>
      <include name="wdk-v${version}/bin/wyc"/>
      <include name="wdk-v${version}/bin/wyjc"/>
      <include name="wdk-v${version}/bin/wyj"/>
    </tarfileset>
    <tarfileset dir="." includes="wdk-v${version}/LICENSE,wdk-v${version}/README,wdk-v${version}/build.xml,wdk-v${version}/config.xml"/>
    <tarfileset dir=".">
      <include name="lib/wyil-v${version}.jar"/>
      <include name="lib/wyc-v${version}.jar"/>
      <include name="lib/wyrt-v${version}.jar"/>
      <include name="lib/wyjc-v${version}.jar"/>
    </tarfileset>
  </tar>
  <gzip destfile="dist/wdk-src-v${version}.tgz" src="dist/wdk-src-v${version}.tar"/>
  <delete file="dist/wdk-src-v${version}.tar"/>
  <delete dir="wdk-v${version}"/>
  </target>

  <target name="dist" depends="distsrc,distjars">
  </target>

</project>
